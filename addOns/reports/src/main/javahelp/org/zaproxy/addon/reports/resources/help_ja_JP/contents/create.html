<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<TITLE>レポートの作成</TITLE>
</HEAD>
<BODY>
	<H1>レポートの作成</H1>

	独自のレポートを簡単に作成できます。
	<p>
		アドオンは <a href="https://www.thymeleaf.org/">Thymeleaf</a>
		テンプレートエンジンを使用しているため、テンプレート構文の詳細についてはそのドキュメントを参照してください。
	</p>
	<p>
		組み込みレポートは、ZAPの<a
			href="https://www.zaproxy.org/faq/what-is-the-default-directory-that-zap-uses/">デフォルトディレクトリ</a>の下にある
		'reports' ディレクトリにコピーされます。 各レポートは独自のサブディレクトリにあります。
		新しいレポートを作成する最も簡単な方法は、既存のものを同じレベルに新しいディレクトリにコピーすることです。
	</p>
	<p>各レポートサブディレクトリには以下を含める必要があります：</p>
	<H3>template.yaml</H3>
	以下の内容を含むファイル：
	<pre>
name:        # レポートの表示名
format:      # 形式、例: HTML, XML, MD, JSON, PDF のいずれか - これは内部的に使用されますが、現在ZAPで公開されていません
mode:        # Thymeleafテンプレートモード、HTML, RAW, TEXT, HTML のいずれか
extension:   # レポート生成時に使用する拡張子
sections:    # オプションのセクションリスト - レポートの含む/除外できる部分
themes:      # オプションのテーマリスト - 同じコンテンツに適用される異なる色とスタイル
</pre>

	<H3>
		report.<i>ext</i>
	</H3>
	Thymeleafレポートテンプレート
	<br> これは template.yaml ファイルで指定された同じ拡張子 (例: 'report.md')
	を持つべきですが、PDFレポートの場合、"html" を使用してください (以下参照)。

	<H3>Messages.properties</H3>
	レポートサブディレクトリには、テンプレート固有の文字列を英語にローカライズした "Messages.properties"
	言語ファイル、および文字列を他の言語にローカライズするための "Message_ locale.property"
	ファイルを含めることもできます。
	<br> テンプレート固有の文字列はすべて '
	<code>report.template.</code>
	' で始まるべきです。
	<br> レポートにセクションが含まれる場合、それらはこのファイルで定義する必要があります - キーは自動的に
	<code>report.template.section.</code>
	でプレフィックスされます。 template.yaml ファイルのセクション名は英数字の文字列でなければならず、整数で始まってはいけません。
	<br> レポートにテーマが含まれる場合、それらはこのファイルで定義する必要があります - キーは自動的に
	<code>report.template.theme.</code>
	でプレフィックスされます。 template.yamlファイルのテーマ名は英数字の文字列でなければならず、整数で始まってはいけません。
	<br> 言語ファイルは、レポートアドオンに組み込まれたデフォルト翻訳をオーバーライドすることもできます。

	<H3>リソース</H3>
	レポートサブディレクトリには、"resources" ディレクトリを含めることもできます。
	これが存在する場合、レポート生成時にレポート名に基づくサブディレクトリが作成され、リソースディレクトリのすべてのファイルがそれにコピーされます。
	<br> "resources"
	サブディレクトリのファイルを以下の方法で参照してください。これにより、テンプレート経由とサブディレクトリ作成時のレポートの両方でアクセス可能になります：
	<pre>
   &lt;script th:src="${resources + '/script.js'}" src="resources/script.js"&gt;&lt;/script&gt;
   &lt;link rel="stylesheet" th:href="${resources + '/style.css'}" href="resources/style.css"&gt;
   &lt;img th:src="${resources + '/image.png'}" src="resources/image.png"&gt;
</pre>
	'traditional-html-plus' テンプレートには、JavaScript、CSS、画像リソースの例が含まれています。

	<H2>利用可能なデータ</H2>
	以下のデータ項目はすべてのレポートで利用可能です。 これらはThymeleaf標準ダイアレクト経由でアクセスできます、例:
	<code>${reportTitle}</code>

	<H3>alertTree</H3>
	レポートに含めるべきすべてのアラートを含むツリー。 これはデスクトップの 'アラート'
	タブに表示される標準ZAPアラートツリーのコピーですが、選択された基準に一致しないアラートを除去したものです。
	<p>ツリーのすべてのノードは AlertNode です。</p>
	<p>トップレベルノードには有用なデータは含まれていません。</p>
	<p>
		見つかった各タイプのアラートごとに第2レベルノードが1つあります。 これらのノードは 'userObject' が<a
			href="https://javadoc.io/doc/org.zaproxy/zap/latest/org/parosproxy/paros/core/scanner/Alert.html">Alert</a>タイプで、アラートデータと関連するリクエストおよびレスポンスへのアクセスを提供します。
	</p>
	<p>第3および最終レベルにはアラートインスタンスが含まれます -
		これらは親ノードと同じタイプで、同じ方法でアラート詳細へのアクセスを提供します。</p>
	<H3>reportTitle</H3>
	ユーザーが設定したレポートのタイトル。

	<H3>description</H3>
	ユーザーが設定したレポートの説明。

	<H3>helper</H3>
	有用なメソッドを提供する
	<a
		href="https://github.com/zaproxy/zap-extensions/tree/main/addOns/reports/src/main/java/org/zaproxy/addon/reports/ReportHelper.java">ReportHelper</a>
	クラスのインスタンス、以下を含む：
	<ul>
		<li><code>getConfidenceString(int confidence)</code>
			関連する信頼度コードの国際化文字列を返す</li>
		<li><code>getRiskString(int risk)</code> 関連するリスクコードの国際化文字列を返す</li>
		<li><code>getHttpStatusCode(int code)</code>
			指定されたHTTPステータスコードの意味を返す</li>
		<li><code>getHostForSite(String site)</code> 指定されたサイトURLのホスト名を返す</li>
		<li><code>getPortForSite(String site)</code> 指定されたサイトURLのポートを返す</li>
		<li><code>isSslSite(String site)</code>
			指定されたサイトURLがSSLを使用している場合、true を返す</li>
		<li><code>getStatisticsString(String stat)</code> 特定の統計キーの意味を返す -
			現在は認証統計のみサポート</li>
		<li><code>getSiteStats(String site, String prefix)</code>
			指定されたサイトの (オプションの) プレフィックスで始まる統計の Map を返す</li>
		<li><code>hasSiteStats(String site, String prefix)</code>
			指定されたサイトが (オプションの) プレフィックスで始まる統計を持つ場合、true を返す</li>
	</ul>

	<H3>alertCounts</H3>

	リスクレベルごとの一意なアラート数の Map。 これをレポートで使用して、例えば概要テーブルを生成できます。

	<H3>alertCountsByRule</H3>

	スキャンルールIDごとのインスタンス数の Map。

	<H3>reportData</H3>
	レポートに含めるデータを定義する
	<a
		href="https://github.com/zaproxy/zap-extensions/tree/main/addOns/reports/src/main/java/org/zaproxy/addon/reports/ReportData.java">ReportData</a>
	クラスのインスタンス。 これを使用して、例えば特定のレベルのアラートがなかったか、または意図的に除外されたかを判断できます。
	<p>自動化ジョブはレポートに追加データを提供でき、多くの場合自動化フレームワークを使用していなくても可能です。
		詳細は、関連ジョブのヘルプページを確認してください。</p>

	<H3>reportData : paramsData</H3>
	サイトで使用されるパラメーターをクエリするメソッドを提供する
	<a
		href="https://github.com/zaproxy/zap-extensions/tree/main/addOns/automation/src/main/java/org/zaproxy/addon/automation/jobs/ParamsJobResultData.java">ParamsJobResultData</a>
	クラスのインスタンス。 これは自動化アドオンに "data job" として含まれており、追加機能を提供しません。

	<H3>stats</H3>
	グローバル統計の Map。 サイトベースの統計はヘルパー経由で利用可能です。

	<H2>レポートのテスト</H2>
	ZAPはレポートテンプレートをキャッシュしないため、レポート生成ごとにそれらを再読み込みします。 これによりテストがはるかに簡単になります。
	レポートに使用するトップレベルディレクトリを 'Template Directory' パラメーターに設定するだけで、
	新しいレポートを作成すると保存したテンプレートの最新バージョンを使用します。
	既存レポートへの変更を反映するためにZAPを再起動する必要はありません。

	<H2>PDF レポート</H2>
	PDFレポートは
	<a href="https://github.com/flyingsaucerproject/flyingsaucer">Flying
		Saucer</a> ライブラリを使用して生成され、HTMLドキュメントをPDF形式に変換します。
	PDFレポートを作成するには、HTMLでデザインし、テンプレート名を "report.html"
	としたうえで、フォーマットに「PDF」を指定する必要があります。
	<p>Flying Saucer は、HTMLが整形式 XML / XHTMLである必要があります。
		テンプレートが整形式でない場合はエラーで失敗するため、詳細は ZAP ログファイルを確認してください。</p>
</BODY>
</HTML>
